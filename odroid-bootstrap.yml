---
- hosts: all
  become: yes
  user: ubuntu
  tasks:

    - name: Allow ubuntu user to sudo on target node
      ansible.builtin.copy: 
        content: |
          #Allow ubuntu to sudo
          ubuntu  ALL=(ALL) NOPASSWD: ALL
        dest: /etc/sudoers.d/sudoers
        validate: 'visudo -cf %s'
        mode: 0440
 
    - name: configure network settings
      ansible.builtin.copy:
        content: |
          # This is the network config written by 'subiquity'
          network:
            ethernets:
              enp2s0:
                dhcp4: true
                dhcp6: false
              enp3s0:
                dhcp4: true
                optional: true
            version: 2
        dest: /etc/netplan/00-installer-config.yaml
      notify: netplan apply

    - name: Set Timezone on nodes
      ansible.builtin.file:
        src: /usr/share/zoneinfo/America/New_York
        dest: /etc/localtime
        owner: root
        group: root
        state: link

  handlers:
    - name: netplan apply
      shell: netplan apply